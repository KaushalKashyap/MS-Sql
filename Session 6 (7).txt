use test;

SELECT * FROM EMP;
SELECT * FROM EMP_SAL;

SELECT EID, NAME, CITY FROM EMP
WHERE DESI = 'MANAGER';

SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER';

SELECT EID, NAME, CITY FROM EMP
WHERE EID IN(1004, 1007, 1008, 1010, 1013, 1028, 1067, 1040, 1074, 1088, 1123);

SELECT EID, NAME, CITY FROM EMP -- OUTER \ MAIN
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER'); -- INNER \ SUB 32 LEVEL


SELECT EID, DEPT, DESI , SALARY FROM EMP_SAL
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'DEHRADUN');


SELECT EMP.EID, NAME , DEPT , DESI
FROM EMP
INNER JOIN EMP_SAL
ON EMP.EID = EMP_SAL.EID
WHERE DEPT = 'MIS';

SELECT * FROM TRAINING;


-- INSERT SUB QUERY

INSERT INTO TRAINING (EID, NAME, DEPT)
SELECT EMP.EID, NAME , DEPT 
FROM EMP
INNER JOIN EMP_SAL
ON EMP.EID = EMP_SAL.EID
WHERE DEPT = 'MIS';

UPDATE TRAINING SET MODULE = 'SQL';

SELECT * FROM TRAINING;

--DELETE SUB QUERY

DELETE FROM TRAINING 
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE DESI LIKE 'MANAGER%');


SELECT * FROM EMP_SAL
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'DEHRADUN');


-- UPDATE SUB QUERY
UPDATE EMP_SAL SET SALARY = SALARY + 5000
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'DEHRADUN');

SELECT COUNT(EID) 'NO OF TEAM MEMBERS', AVG(SALARY ) AS'AVGSAL'
FROM EMP_SAL;

SELECT COUNT(EID) 'DELHI TEAM MEMBERS', AVG(SALARY ) AS'DELAVGSAL' FROM EMP_SAL
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'DELHI');

SELECT COUNT(EID) 'DELHI TEAM MEMBERS > 300K', AVG(SALARY ) AS'DELAVGSAL' FROM EMP_SAL  --A
WHERE EID IN (SELECT EID FROM EMP WHERE CITY = 'DELHI'-- B
				AND EID IN (SELECT EID FROM EMP_SAL WHERE SALARY > 300000));-- C

-- A => B => C - A=>C

SELECT EID, NAME, CITY FROM EMP 
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE DESI = 'MANAGER');

SELECT EID, NAME, CITY FROM EMP
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE SALARY > 300000 )
ORDER BY EID DESC;

SELECT EID , NAME, CITY FROM EMP
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE SALARY >= 300000);

SELECT EID , NAME, CITY FROM EMP
WHERE EID IN (SELECT EID FROM EMP_SAL WHERE SALARY BETWEEN 200000 AND  300000);

SELECT * FROM EMP_SAL WHERE DEPT = 'HR'
AND EXISTS (SELECT * FROM EMP_SAL WHERE DEPT = 'HR' AND SALARY > 300000);


CREATE PROCEDURE L28SEMP
AS
BEGIN
	SELECT * FROM EMP
	WHERE CITY = 'DELHI';
END;

EXECUTE L28SEMP;
EXEC L28SEMP;

L28SEMP;

DROP PROCEDURE L28SEMP;

CREATE PROCEDURE L28SEMP @C AS VARCHAR(20)
AS
BEGIN
	SELECT * FROM EMP
	WHERE CITY = @C;
END;

L28SEMP 'DELHI';

SELECT * FROM EMP;

INSERT INTO EMP
VALUES(1194, 'DEEPANKAR GUPTA', 'SECTOR 17', 'DWARKA', 'DELHI', '9811554430','DEEPANKAr@GMAIL.COM', '26-SEP-1991', '23-NOV-2020');

DELETE FROM EMP WHERE EID = 1194;
DELETE FROM EMP_SAL WHERE EID = 1194;

CREATE PROCEDURE L28INEMP @ID AS INT, @N AS VARCHAR(20), @A1 AS VARCHAR(30), @A2 AS VARCHAR(30), @C AS VARCHAR(30), @PH CHAR(15), @EM AS VARCHAR(50), @DB DATE, @DJ DATE
AS
BEGIN
	INSERT INTO EMP
	VALUES (@ID, @N, @A1, @A2, @C, @PH, @EM, @DB, @DJ);

	SELECT * FROM EMP
	WHERE EID = @ID;
END;

L28INEMP 1194, 'DEEPANKAR GUPTA', 'SECTOR 17', 'DWARKA', 'DELHI', '9811554430','DEEPANKAr@GMAIL.COM', '26-SEP-1991', '23-NOV-2020';

SELECT * FROM EMP_SAL;

DROP PROCEDURE L28INEMP;

CREATE PROCEDURE L28INEMP @ID AS INT, @N AS VARCHAR(20), @A1 AS VARCHAR(30), @A2 AS VARCHAR(30), @C AS VARCHAR(30), @PH CHAR(15), @EM AS VARCHAR(50), @DB DATE, @DJ DATE, @DPT AS VARCHAR(20), @DSI AS VARCHAR(30), @S AS INT
AS
BEGIN
	SET NOCOUNT ON ;
	INSERT INTO EMP
	VALUES (@ID, @N, @A1, @A2, @C, @PH, @EM, @DB, @DJ);

	INSERT INTO EMP_SAL 
	VALUES (@ID, @DPT, @DSI, @S);

	SELECT * FROM EMP
	WHERE EID = @ID;

	SELECT * FROM EMP_SAL 
	WHERE EID = @ID;

	SELECT EMP.EID, NAME, CITY , DOJ, DEPT , DESI, SALARY AS 'BASIC', SALARY * .15 AS 'HRA', SALARY *.09 AS 'PF'
	FROM EMP
	INNER JOIN EMP_SAL
	ON EMP.EID = EMP_SAL.EID
	WHERE EMP.EID = @ID;
END;

L28INEMP 1194, 'DEEPANKAR GUPTA', 'SECTOR 17', 'DWARKA', 'DELHI', '9811554430','DEEPANKAR@GMAIL.COM', '26-SEP-1991', '23-NOV-2020', 'TEMP', 'INTERN', 45000;


CREATE PROCEDURE L28SHOW @T AS VARCHAR(20)
AS
BEGIN
	EXEC('SELECT * FROM ' + @T);
END;

L28SHOW 'EMP';

SELECT MAX(SALARY) FROM EMP_SAL;

SELECT * FROM EMP_SAL 
WHERE SALARY = 520000;

SELECT * FROM EMP_SAL 
WHERE SALARY = (SELECT MAX(SALARY) FROM EMP_SAL);

