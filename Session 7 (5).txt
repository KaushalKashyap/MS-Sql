use learn28;

CREATE TABLE TEST
(ID INT,
NAME VARCHAR(10)
);

INSERT INTO TEST VALUES (1, 'A');
INSERT INTO TEST VALUES (2, 'B');
INSERT INTO TEST VALUES (3, 'C');
INSERT INTO TEST VALUES (4, 'D');
INSERT INTO TEST VALUES (5, 'E');
INSERT INTO TEST VALUES (6 ,'F');
INSERT INTO TEST VALUES (7, 'G');
INSERT INTO TEST VALUES (8, 'H');
INSERT INTO TEST VALUES (9, 'I');
INSERT INTO TEST VALUES (10, 'J');

SELECT * FROM TEST;

DELETE FROM TEST WHERE ID = 10;

BEGIN TRANSACTION;

DELETE FROM TEST WHERE ID = 9;

SELECT * FROM TEST;

ROLLBACK;

BEGIN TRANSACTION ;

DELETE FROM TEST WHERE ID = 9;
DELETE FROM TEST WHERE ID = 8;
DELETE FROM TEST WHERE ID = 7;
DELETE FROM TEST WHERE ID = 6;
DELETE FROM TEST WHERE ID = 5;

ROLLBACK;

SELECT * FROM TEST;

BEGIN TRANSACTION;

DELETE FROM TEST WHERE ID = 4;

SAVE TRANSACTION T1; -- SAVE POINT
DELETE FROM TEST WHERE ID = 5;

SAVE TRANSACTION T2;
DELETE FROM TEST WHERE ID = 6;

SAVE TRANSACTION T3;
DELETE FROM TEST WHERE ID = 7;
DELETE FROM TEST WHERE ID = 8;

SAVE TRANSACTION T4;
DELETE FROM TEST WHERE ID = 9;

SELECT* FROM TEST;

ROLLBACK TRANSACTION T1;

BEGIN TRANSACTION;

DELETE FROM TEST WHERE ID = 9;

COMMIT;

ROLLBACK;

DROP TABLE EMP2;
CREATE TABLE EMP2
(EID INT IDENTITY (100,10), --START, INCREMENT
NAME VARCHAR(20),
AGE INT);

INSERT INTO EMP2 (NAME, AGE)
VALUES('AMIT SHARMA', 27);

INSERT INTO EMP2
VALUES('GAGAN KAPOOR', 32);

INSERT INTO EMP2
VALUES ('MOHIT SINGH', 28);

SELECT * FROM EMP2;

CREATE PROCEDURE INEMP2 @N AS VARCHAR(20), @X AS INT
AS
BEGIN
	INSERT INTO EMP2
	VALUES(@N, @X);

	SELECT * FROM EMP2;
END;

INEMP2 'RAJAT MATHUR', 32;
INEMP2 ' SANJAY SHARMA', 29;

DELETE FROM EMP2 WHERE EID = 4;

DROP SEQUENCE MYSEQ;

CREATE SEQUENCE MYSEQ
AS INT
START WITH 1
INCREMENT BY 1
MAXVALUE 10
MINVALUE 1
CYCLE
CACHE 5;

SELECT NEXT VALUE FOR MYSEQ;

DROP SEQUENCE MYSEQ;
DROP TABLE EMP3;

CREATE SEQUENCE MYSEQ
AS INT
START WITH 1
INCREMENT BY 1;

CREATE TABLE EMP3
(EID INT,
NAME VARCHAR(20),
AGE INT);

INSERT INTO EMP3
VALUES(NEXT VALUE FOR MYSEQ, 'RAM KUMAR', 32);

INSERT INTO EMP3
VALUES(NEXT VALUE FOR MYSEQ, 'GAURAV KAPOOR', 33);

SELECT * FROM EMP3;

DROP PROCEDURE INEMP3;

CREATE PROCEDURE INEMP3 @N AS VARCHAR(20), @X AS INT
AS
BEGIN
	INSERT INTO EMP3
	VALUES(NEXT VALUE FOR MYSEQ, @N, @X);

	SELECT * FROM EMP3;
END;

INEMP3 'AMIT GUPTA', 27;
INEMP3 'ROHAN SANI', 29;
INEMP3 'MONIKA ARORA', 31;
INEMP3 'AJAY GUPTA' , 32;
INEMP3 'RAM KAPOOR', 34;
CREATE TABLE EMP3
(EID CHAR(5),
NAME VARCHAR(20),
AGE INT);


DROP PROCEDURE INEMP3;
CREATE PROCEDURE INEMP3 @N AS VARCHAR(20), @X AS INT
AS
BEGIN

	DECLARE @I AS INT;
	DECLARE @ID as CHAR(5);

	SET @I = (NEXT VALUE FOR MYSEQ);

	IF @I < 10
		SET @ID = CONCAT('E000', @I);
	ELSE IF @I < 100
		SET @ID = CONCAT('E00', @I);
	ELSE IF @I < 1000
		SET @ID = CONCAT('E0', @I);
	ELSE IF @I < 10000
		SET @ID = CONCAT('E', @I);
	ELSE
		SET @ID = 'NA'

	INSERT INTO EMP3
	VALUES(@ID, @N, @X);

	SELECT * FROM EMP3;
END;

DROP FUNCTION CID;
CREATE FUNCTION CID (@C AS CHAR(1), @I AS INT)
RETURNS CHAR(5)
AS
BEGIN 
	DECLARE @ID AS CHAR(5);
	
	IF @I < 10
		SET @ID = CONCAT(@C,'000', @I);
	ELSE IF @I < 100
		SET @ID = CONCAT(@C,'00', @I);
	ELSE IF @I < 1000
		SET @ID = CONCAT(@C,'0', @I);
	ELSE IF @I < 10000
		SET @ID = CONCAT(@C, @I);
	ELSE
		SET @ID = 'NA'

	return @ID;
END;

SELECT DBO.CID('C', 13);

CREATE FUNCTION CID (@C AS CHAR(1), @I AS INT)
RETURNS CHAR(5)
AS
BEGIN 
	DECLARE @ID AS CHAR(5);

	SELECT @ID = CASE	
					WHEN @I < 10 THEN CONCAT(@C, '000', @I)
					WHEN @I < 100 THEN CONCAT(@C, '00', @I)
					WHEN @I < 1000 THEN CONCAT(@C, '0', @I)
					WHEN @I < 10000 THEN CONCAT(@C,  @I)
					ELSE 'NA'
	END;
	RETURN @ID;
END;

SELECT DBO.CID('C', 91);

CREATE PROCEDURE INEMP3 @N AS VARCHAR(20), @X AS INT
AS
BEGIN

	DECLARE @I AS INT;
	DECLARE @ID as CHAR(5);

	SET @I = (NEXT VALUE FOR MYSEQ);

	SET @ID = DBO.CID('E', @I);

	INSERT INTO EMP3
	VALUES(@ID, @N, @X);

	SELECT * FROM EMP3;
END;

INEMP3 'KOMAL GUPTA', 26;